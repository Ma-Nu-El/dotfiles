#!/usr/bin/env bash
if [[ -z "$1"  ]]
then
echo 'tpoverwrite is a bash macro to overwrite tmuxp sessions'
echo 'type '\''tpoverwrite --help'\'' for more info'
exit
fi
if [[ $1 == '--help' ]]
then
echo 'tpoverwrite - tmuxp overwrite'
echo ''
echo 'tpoverwrite is a bash macro that lets you quickly overwrite an'
echo 'EXISTING tmuxp session (it won'\''t create a new one from scratch).'
echo ''
echo 'source code: '
echo 'USAGE'
echo ''\''tpoverwrite OPTION'\'''
echo ''
echo 'OPTIONS'
echo '--overwrite (or -o)'
echo 'overwrite your EXISTING tmuxp frozen file'
echo ''
echo '--depython (or -d)'
echo 'remove that '\''python3'\'' line from the frozen file'
echo 'for the moment it only works with .yaml files since I don'\''t know yet'
echo 'how to implement TAB completion from within a bash script :D'
echo 'Happy coding'
exit
fi
if [[ "$1" != "--help" ]] || [[ -z $1 ]]
then
FILE_LOCATION=~/.tmuxp
SESSION_NAME=$(tmux display-message -p '#S')
EXTENSION=yaml
YOUR_FILE=$FILE_LOCATION/$SESSION_NAME.$EXTENSION
fi
if [[ "$1" == "-o" ]] || [[ "$1" == "--overwrite" ]]
then
echo "Overwriting your tmuxp session:"
cat $YOUR_FILE > $YOUR_FILE~ # for backup
rm $YOUR_FILE
tmuxp freeze
echo 'tmuxp session backed up and overwriten in:'
echo $YOUR_FILE
fi
if [[ "$1" == "-r" ]] || [[ "$1" == "--recover" ]]
then
if mv "$YOUR_FILE~" "$YOUR_FILE"
then
echo 'renamed:'
echo \'$YOUR_FILE~\'
echo 'to'
echo \'$YOUR_FILE\'
fi
fi
if [[ "$1" == "-d" ]] || [[ "$1" == "--depython" ]]
then
echo 'Warning: if you actually are running anything that contains the word'
echo 'python3 and gets saved into the session, it could mess with your'
echo 'tmuxp freeze file.'
echo ''
echo 'A backup of your file will be stored in'
echo '/tmp/tmuxp/frozenPreCleaning/'
echo 'in case anything goes wrong.'
AUX_FILE=$FILE_LOCATION/auxFile
cat $YOUR_FILE > ~/.tmuxp/depython/$SESSION_NAME.$EXTENSION
sed '/python3/d' $YOUR_FILE > $AUX_FILE
cat $AUX_FILE > $YOUR_FILE
echo 'file depythoned.'
fi
exit
